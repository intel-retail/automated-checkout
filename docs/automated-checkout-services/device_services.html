
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>Device Services - Automated Checkout</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#device-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Automated Checkout" class="md-header__button md-logo" aria-label="Automated Checkout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Automated Checkout
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Device Services
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Automated Checkout" class="md-nav__button md-logo" aria-label="Automated Checkout" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Automated Checkout
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Automated Checkout Reference Implementation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Phases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Phases" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Phases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phases/phase1.html" class="md-nav__link">
        Phase 1 - Simulation Mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phases/phase2.html" class="md-nav__link">
        Phase 2 - Add Card Reader Device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phases/phase3.html" class="md-nav__link">
        Phase 3 - Bring Your Own Hardware and Software
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Additional Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Additional Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Automated Checkout Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Automated Checkout Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Automated Checkout Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Device Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="device_services.html" class="md-nav__link md-nav__link--active">
        Device Services
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#list-of-device-services" class="md-nav__link">
    List of device services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#card-reader" class="md-nav__link">
    Card reader
  </a>
  
    <nav class="md-nav" aria-label="Card reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#card-reader-description" class="md-nav__link">
    Card reader description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-reader-physical-device-functionality" class="md-nav__link">
    Card reader physical device functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-reader-apis" class="md-nav__link">
    Card reader APIs
  </a>
  
    <nav class="md-nav" aria-label="Card reader APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv2devicenamecard-readercard-number" class="md-nav__link">
    PUT: http://localhost:48098/api/v2/device/name/card-reader/card-number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv2devicenamecard-readerstatus" class="md-nav__link">
    GET: http://localhost:48098/api/v2/device/name/card-reader/status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-board" class="md-nav__link">
    Controller board
  </a>
  
    <nav class="md-nav" aria-label="Controller board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controller-board-description" class="md-nav__link">
    Controller board description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-board-physical-device-functionality" class="md-nav__link">
    Controller board physical device functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-board-apis" class="md-nav__link">
    Controller board APIs
  </a>
  
    <nav class="md-nav" aria-label="Controller board APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardlock1" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/lock1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardlock2" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/lock2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boarddisplayrow0" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/displayRow0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsettemperature" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setTemperature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsethumidity" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setHumidity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsetdoorclosed" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setDoorClosed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cv-inference" class="md-nav__link">
    CV inference
  </a>
  
    <nav class="md-nav" aria-label="CV inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cv-inference-description" class="md-nav__link">
    CV inference description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cv-inference-apis" class="md-nav__link">
    CV inference APIs
  </a>
  
    <nav class="md-nav" aria-label="CV inference APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost59982apiv2devicenameinference-deviceinferenceheartbeat" class="md-nav__link">
    GET: http://localhost:59982/api/v2/device/name/Inference-device/inferenceHeartbeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost59982apiv2devicenameinference-deviceinferencedoorstatus" class="md-nav__link">
    PUT: http://localhost:59982/api/v2/device/name/Inference-device/inferenceDoorStatus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="application_services.html" class="md-nav__link">
        Application Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="micro_services.html" class="md-nav__link">
        Other Microservices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../events.html" class="md-nav__link">
        Automated Checkout Events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration.html" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../modifying_source_code.html" class="md-nav__link">
        Modifying source code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notifications.html" class="md-nav__link">
        How to Send Notifications through EdgeX (optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../references.html" class="md-nav__link">
        References
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting.html" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#list-of-device-services" class="md-nav__link">
    List of device services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#card-reader" class="md-nav__link">
    Card reader
  </a>
  
    <nav class="md-nav" aria-label="Card reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#card-reader-description" class="md-nav__link">
    Card reader description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-reader-physical-device-functionality" class="md-nav__link">
    Card reader physical device functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-reader-apis" class="md-nav__link">
    Card reader APIs
  </a>
  
    <nav class="md-nav" aria-label="Card reader APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv2devicenamecard-readercard-number" class="md-nav__link">
    PUT: http://localhost:48098/api/v2/device/name/card-reader/card-number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv2devicenamecard-readerstatus" class="md-nav__link">
    GET: http://localhost:48098/api/v2/device/name/card-reader/status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-board" class="md-nav__link">
    Controller board
  </a>
  
    <nav class="md-nav" aria-label="Controller board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controller-board-description" class="md-nav__link">
    Controller board description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-board-physical-device-functionality" class="md-nav__link">
    Controller board physical device functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-board-apis" class="md-nav__link">
    Controller board APIs
  </a>
  
    <nav class="md-nav" aria-label="Controller board APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardlock1" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/lock1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardlock2" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/lock2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boarddisplayrow0" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/displayRow0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsettemperature" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setTemperature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsethumidity" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setHumidity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48097apiv2devicenamecontroller-boardsetdoorclosed" class="md-nav__link">
    PUT: http://localhost:48097/api/v2/device/name/controller-board/setDoorClosed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cv-inference" class="md-nav__link">
    CV inference
  </a>
  
    <nav class="md-nav" aria-label="CV inference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cv-inference-description" class="md-nav__link">
    CV inference description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cv-inference-apis" class="md-nav__link">
    CV inference APIs
  </a>
  
    <nav class="md-nav" aria-label="CV inference APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost59982apiv2devicenameinference-deviceinferenceheartbeat" class="md-nav__link">
    GET: http://localhost:59982/api/v2/device/name/Inference-device/inferenceHeartbeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost59982apiv2devicenameinference-deviceinferencedoorstatus" class="md-nav__link">
    PUT: http://localhost:59982/api/v2/device/name/Inference-device/inferenceDoorStatus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="device-services">Device Services</h1>
<p>The <strong>Automated Checkout</strong> reference implementation utilizes three device services that are used to communicate hardware event data to underlying EdgeX framework.</p>
<h2 id="list-of-device-services">List of device services</h2>
<ul>
<li>Card reader – Handles the interface between an RFID card reader and EdgeX.</li>
<li>Controller board – Handles the interface between Arduino firmware and EdgeX.</li>
<li>CV Inference –  computer vision inference service using openVINO.</li>
</ul>
<h2 id="card-reader">Card reader</h2>
<h3 id="card-reader-description">Card reader description</h3>
<p>The <code>ds-card-reader</code> device service is an EdgeX device service that allows a USB-based RFID card reader to grant access to the Automated Checkout. At a high level, this device service is responsible for discovering a specific card reader device, watching for input from that device, parsing that input, and then forwarding the input into the EdgeX framework.</p>
<p>There are two different modes available to this device service:</p>
<ol>
<li><strong>Physical Mode:</strong> for use with a physical controller board device</li>
<li><strong>Virtual Mode:</strong> used when simulating a physical controller board by using a RESTful endpoint</li>
</ol>
<p>The EdgeX Core services are required for the <code>ds-card-reader</code> to publish the card ID into the EdgeX bus (zeroMQ). Without the EdgeX core services, this device service will not function.</p>
<h3 id="card-reader-physical-device-functionality">Card reader physical device functionality</h3>
<p>The <code>ds-card-reader</code> service is much simpler than the <code>ds-controller-board</code> service, because it only requires mounting <code>/dev/input:/dev/input</code> at runtime. However, it still requires root privileges in the container at runtime so that it can interact directly with event/USB drivers.</p>
<h3 id="card-reader-apis">Card reader APIs</h3>
<hr />
<h4 id="put-httplocalhost48098apiv2devicenamecard-readercard-number"><code>PUT</code>: <code>http://localhost:48098/api/v2/device/name/card-reader/card-number</code></h4>
<p>The <code>PUT</code> API endpoint will push the badge ID (which is sent as part of the API request body) into the card reader device service. Once the card reader device service receives the badge ID, the badge ID will be pushed into the EdgeX bus for other application services to utilize.</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;card-number&quot;:&quot;0003278200&quot;}&#39;</span> http://localhost:48098/api/v2/device/name/card-reader/card-number
</code></pre></div>

<p>Sample response:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;statusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<hr />
<h4 id="get-httplocalhost48098apiv2devicenamecard-readerstatus"><code>GET</code>: <code>http://localhost:48098/api/v2/device/name/card-reader/status</code></h4>
<p>The <code>GET</code> API endpoint returns data that is not meant to be consumed for any particular purpose. When triggering this endpoint, it will execute a function (in the Go source code) called <code>CardReaderStatus</code> that is used as an auto-remediation mechanism to attempt to "grab" the physical card reader HID device (via <a href="https://en.wikipedia.org/wiki/Evdev"><code>evdev</code></a>). If it succeeds in grabbing the underlying device, that means that the <code>ds-card-reader</code> device service has lost its hold on the card reader, and we need to restart the service. This endpoint is meant to be hit frequently.</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:48098/api/v2/device/name/card-reader/status
</code></pre></div>

<p>Sample response:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;statusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<hr />
<h2 id="controller-board">Controller board</h2>
<h3 id="controller-board-description">Controller board description</h3>
<p>The <code>ds-controller-board</code> device service is responsible for handling communication with a custom-built Arduino micro-controller board (or virtual board if you don't have physical hardware). It provides functionality for reading the lock status, door status, temperature, and humidity readings, while also sending commands to the controller board to unlock the mag-lock, and display output to the LCD.</p>
<p>There are two different modes available for this device service:</p>
<ol>
<li><strong>Physical Mode:</strong> for use with a physical controller board device</li>
<li><strong>Virtual Mode:</strong> used when simulating a physical controller board by using a RESTful endpoint</li>
</ol>
<h3 id="controller-board-physical-device-functionality">Controller board physical device functionality</h3>
<p>When not running in simulated mode (i.e. a physical controller board device is plugged into your system), the <code>ds-controller-board</code> Docker container service requires <code>/dev/ttyACM0</code>, which is the typically the default serial port for an Arduino microcontroller.</p>
<p>This may change if you have multiple serial devices plugged in. Please ensure that <code>/dev/ttyACM0</code> maps to the appropriate serial device if you plan to run the <code>ds-controller-board</code> service with a physical device.</p>
<p>It is important to note that the <code>ds-controller-board</code> service <em>is</em> capable of automatically finding a TTY port <em>aside</em> from <code>/dev/ttyACM0</code>. It actually looks for the vendor and product ID (VID/PID) values specified in the service's configuration. The problems arise when we have to mount the TTY port via Docker:</p>
<ul>
<li>mounting <code>/dev:/dev</code> to the container at runtime solves the problem, but creates security risks and requires <code>--privileged=true</code> on the container, which is bad practice and can lead to security issues</li>
<li>mounting <code>/dev/ttyACM0:/dev/ttyACM0</code> solves the problem, assuming there is only one serial device</li>
</ul>
<p>Therefore, if you have multiple serial devices plugged into your system, please manually edit the <code>docker-compose.ac.yml</code> file to mount your <code>/dev/ttyACM_X_</code> appropriately. You may want to explore creating udev rules to enforce TTY consistency.</p>
<h3 id="controller-board-apis">Controller board APIs</h3>
<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boardlock1"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/lock1</code></h4>
<p>This <code>PUT</code> command will operate magnetic <code>lock1</code>. Depending on the numeric value of <code>lock1</code> (boolean <code>0/1</code>), the lock state will either be locked or unlocked.</p>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock1&quot;:&quot;0&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/lock1
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock1&quot;:&quot;0&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/lock1
</code></pre></div>

<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boardlock2"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/lock2</code></h4>
<p>This <code>PUT</code> command will operate magnetic <code>lock2</code>. Depending on the numeric value of <code>lock2</code> (boolean <code>0/1</code>), the lock state will either be locked or unlocked.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently <code>lock2</code> has no purpose. During the initial architect/design phase of Automated Checkout, there were two locks. This was later reduced to a single mag-lock.</p>
</div>
<p>Sample usage:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock2&quot;:&quot;1&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/lock2
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock2&quot;:&quot;1&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/lock2
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boarddisplayrow0"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/displayRow0</code></h4>
<p>This <code>PUT</code> command will operate the display (LCD) and control the text to be put on the first line of the display.</p>
<p>Simple usage :</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;displayRow0&quot;:&quot;The Earth is round&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/displayRow0
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;displayRow0&quot;:&quot;The Earth is round&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/displayRow0
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>On the endpoint URL, Change displayRow<strong>0</strong> index to 1, 2, or 3 to display and control the text to be put on the second, third, and forth line accordingly.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boardsettemperature"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/setTemperature</code></h4>
<p>This <code>PUT</code> command will emulate the temperature sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setTemperature</em> is a float64. Any non-float64 value will be interpreted as '0.00' (do not have to specify decimal values).</p>
</div>
<p>Simple usage :</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setTemperature&quot;:&quot;12.00&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/setTemperature
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setTemperature&quot;:&quot;12.00&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/setTemperature
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boardsethumidity"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/setHumidity</code></h4>
<p>This <code>PUT</code> command will emulate the humidity sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setHumidity</em> is an integer. Any non-integer value will be interpreted as '0'.</p>
</div>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setHumidity&quot;:&quot;12&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/setHumidity
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setHumidity&quot;:&quot;12&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/setHumidity
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48097apiv2devicenamecontroller-boardsetdoorclosed"><code>PUT</code>: <code>http://localhost:48097/api/v2/device/name/controller-board/setDoorClosed</code></h4>
<p>This <code>PUT</code> command will emulate the "door-closed" state sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setDoorClosed</em> is a boolean-integer. Any non-boolean-integer value will be interpreted as '0' (and thus 'false'). Only '1' will result in 'true'.</p>
</div>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setDoorClosed&quot;:&quot;0&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/controller-board/setDoorClosed
</code></pre></div>

<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setDoorClosed&quot;:&quot;0&quot;}&#39;</span> http://localhost:48097/api/v2/device/name/controller-board/setDoorClosed
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h2 id="cv-inference">CV inference</h2>
<h3 id="cv-inference-description">CV inference description</h3>
<p>The <code>ds-cv-inference</code> contains the following components:</p>
<ul>
<li>A golang implementation using openVINO inference engine and openVINO product detection model. This application uses preloaded images as an input to calculate inventory deltas. The images contain some products supported by the model and are used to simulate a purchase or stocking the cooler.
The openVINO product detection model is intended for demo purposes. For production environment, please replace it with your own model.</li>
<li>The preloaded images are used in sequence to simulate a purchase using a circular queue to loop through them.</li>
<li>An <a href="https://github.com/edgexfoundry/device-mqtt-go">EdgeX MQTT device service</a> that converts MQTT messages into EdgeX event readings</li>
</ul>
<p>The following picture illustrates the flow to calculate the inventory deltas between two preloaded images:</p>
<p align="center">
    <img src="../images/delta.png">
</p>

<p>The Automated Checkout architecture uses three MQTT topics:</p>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inference/CommandTopic</td>
<td>All events pushed from EdgeX's command API are fed into this topic. The <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> and <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-controller-board-status"><code>as-controller-board-status</code></a> are two services that make requests to this API, typically for making door close/open and heartbeat events.</td>
</tr>
<tr>
<td>Inference/ResponseTopic</td>
<td>The Automated Checkout cv inference service will respond to published messages on the <code>Inference/CommandTopic</code> topic on the <code>Inference/ResponseTopic</code> topic.</td>
</tr>
<tr>
<td>Inference/DataTopic</td>
<td>The cv inference service publishes delta SKUs on this topic, then the MQTT device service converts them into EdgeX event readings, and finally the <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> service processes the event readings and pushes them to downstream services.</td>
</tr>
</tbody>
</table>
<h3 id="cv-inference-apis">CV inference APIs</h3>
<hr />
<h4 id="get-httplocalhost59982apiv2devicenameinference-deviceinferenceheartbeat"><code>GET</code>: <code>http://localhost:59982/api/v2/device/name/Inference-device/inferenceHeartbeat</code></h4>
<p>The <code>GET</code> call to the EdgeX MQTT device service's <code>inferenceHearbeat</code> command will act as a health-check for the Automated Checkout cv inference service. It must return <code>200 OK</code> upon swiping an RFID card in order for the vending workflow to begin. If it does not, the <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> service will enter maintenance mode.</p>
<p>Simple usage example:</p>
<p>Through EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:59882/api/v2/device/name/Inference-device/inferenceHeartbeat
</code></pre></div>

<p>To MQTT device service itself:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:59982/api/v2/device/name/Inference-device/inferenceHeartbeat
</code></pre></div>

<p>Sample response, <code>200 OK</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Inference-device&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;origin&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579637607912</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;readings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;origin&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579637607911</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Inference-device&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inferenceHeartbeat&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inferencePong&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<hr />
<h4 id="put-httplocalhost59982apiv2devicenameinference-deviceinferencedoorstatus"><code>PUT</code>: <code>http://localhost:59982/api/v2/device/name/Inference-device/inferenceDoorStatus</code></h4>
<p>The <code>PUT</code> call to the EdgeX MQTT device service's <code>inferenceDoorStatus</code> command will cause the cv inference service to consume the message, and if the JSON <code>PUT</code> key <code>inferenceDoorStatus</code> has the string value <code>"true"</code>, an inference attempt will begin. The service will subsequently respond with a message containing the inventory delta (aka SKU delta).</p>
<p>Simple usage example:</p>
<p>Through EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -d <span class="s1">&#39;{&quot;inferenceDoorStatus&quot;:&quot;true&quot;}&#39;</span> http://localhost:59882/api/v2/device/name/Inference-device/inferenceDoorStatus
</code></pre></div>

<p>To MQTT device service itself:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -d <span class="s1">&#39;{&quot;inferenceDoorStatus&quot;:&quot;true&quot;}&#39;</span> http://localhost:59982/api/v2/device/name/Inference-device/inferenceDoorStatus
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<hr />





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../phases/phase3.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Phase 3 - Bring Your Own Hardware and Software" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Phase 3 - Bring Your Own Hardware and Software
            </div>
          </div>
        </a>
      
      
        
        <a href="application_services.html" class="md-footer__link md-footer__link--next" aria-label="Next: Application Services" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Application Services
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.078830c0.min.js"></script>
      
        <script src="https://unpkg.com/lunr/lunr.js"></script>
      
    
  </body>
</html>